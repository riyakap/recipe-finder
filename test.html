<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Recipe Finder - Debug Test</title>
    <style>
        body { font-family: Arial, sans-serif; max-width: 800px; margin: 0 auto; padding: 20px; }
        .test-section { margin: 20px 0; padding: 20px; border: 1px solid #ddd; border-radius: 8px; }
        .success { background: #d4edda; border-color: #c3e6cb; }
        .error { background: #f8d7da; border-color: #f5c6cb; }
        .info { background: #d1ecf1; border-color: #bee5eb; }
        button { padding: 10px 20px; margin: 5px; cursor: pointer; }
        pre { background: #f8f9fa; padding: 10px; border-radius: 4px; overflow-x: auto; }
        .loading { opacity: 0.6; }
    </style>
</head>
<body>
    <h1>üç≥ Recipe Finder - Debug Test</h1>
    
    <div class="test-section info">
        <h2>Environment Check</h2>
        <p><strong>Protocol:</strong> <span id="protocol"></span></p>
        <p><strong>User Agent:</strong> <span id="userAgent"></span></p>
        <p><strong>API Key:</strong> <span id="apiKeyStatus"></span></p>
    </div>

    <div class="test-section">
        <h2>API Tests</h2>
        <button onclick="testTheMealDB()">Test TheMealDB (Free)</button>
        <button onclick="testSpoonacular()">Test Spoonacular (API Key)</button>
        <button onclick="testIngredientLoad()">Test Ingredient Database</button>
        <div id="testResults"></div>
    </div>

    <div class="test-section">
        <h2>Quick Recipe Search</h2>
        <input type="text" id="testIngredient" placeholder="Enter ingredient (e.g., chicken)" value="chicken">
        <button onclick="quickSearch()">Search Recipes</button>
        <div id="searchResults"></div>
    </div>

    <script>
        // Load constants
        const API_CONFIG = {
            SPOONACULAR: {
                BASE_URL: 'https://api.spoonacular.com/recipes',
                API_KEY: '9c7e3df995894afe93d4e8a335f06be8', // Your API key
                ENDPOINTS: {
                    FIND_BY_INGREDIENTS: '/findByIngredients',
                    RECIPE_INFORMATION: '/information'
                }
            },
            THEMEALDB: {
                BASE_URL: 'https://www.themealdb.com/api/json/v1/1',
                ENDPOINTS: {
                    SEARCH_BY_INGREDIENT: '/filter.php?i='
                }
            }
        };

        // Initialize page
        document.addEventListener('DOMContentLoaded', function() {
            document.getElementById('protocol').textContent = window.location.protocol;
            document.getElementById('userAgent').textContent = navigator.userAgent.substring(0, 100) + '...';
            document.getElementById('apiKeyStatus').textContent = API_CONFIG.SPOONACULAR.API_KEY ? 'Present ‚úì' : 'Missing ‚úó';
            
            if (window.location.protocol === 'file:') {
                document.body.insertAdjacentHTML('afterbegin', 
                    '<div class="test-section error"><strong>‚ö†Ô∏è CORS Warning:</strong> You\'re running from file://. This may block API calls. Try using a local server instead.</div>'
                );
            }
        });

        function logResult(message, type = 'info') {
            const div = document.createElement('div');
            div.className = `test-section ${type}`;
            div.innerHTML = `<pre>${message}</pre>`;
            document.getElementById('testResults').appendChild(div);
        }

        async function testTheMealDB() {
            logResult('Testing TheMealDB API...', 'info');
            try {
                const response = await fetch(`${API_CONFIG.THEMEALDB.BASE_URL}${API_CONFIG.THEMEALDB.ENDPOINTS.SEARCH_BY_INGREDIENT}chicken`);
                const data = await response.json();
                
                if (data.meals && data.meals.length > 0) {
                    logResult(`‚úÖ TheMealDB Success: Found ${data.meals.length} recipes`, 'success');
                    logResult(`Sample recipe: ${data.meals[0].strMeal}`, 'info');
                } else {
                    logResult('‚ùå TheMealDB: No recipes found', 'error');
                }
            } catch (error) {
                logResult(`‚ùå TheMealDB Error: ${error.message}`, 'error');
            }
        }

        async function testSpoonacular() {
            if (!API_CONFIG.SPOONACULAR.API_KEY) {
                logResult('‚ùå No Spoonacular API key provided', 'error');
                return;
            }

            logResult('Testing Spoonacular API...', 'info');
            try {
                const url = `${API_CONFIG.SPOONACULAR.BASE_URL}${API_CONFIG.SPOONACULAR.ENDPOINTS.FIND_BY_INGREDIENTS}?ingredients=chicken&number=5&apiKey=${API_CONFIG.SPOONACULAR.API_KEY}`;
                const response = await fetch(url);
                
                if (!response.ok) {
                    throw new Error(`HTTP ${response.status}: ${response.statusText}`);
                }
                
                const data = await response.json();
                
                if (data && data.length > 0) {
                    logResult(`‚úÖ Spoonacular Success: Found ${data.length} recipes`, 'success');
                    logResult(`Sample recipe: ${data[0].title}`, 'info');
                } else {
                    logResult('‚ùå Spoonacular: No recipes found', 'error');
                }
            } catch (error) {
                logResult(`‚ùå Spoonacular Error: ${error.message}`, 'error');
                if (error.message.includes('401')) {
                    logResult('This usually means the API key is invalid or expired', 'error');
                } else if (error.message.includes('402')) {
                    logResult('This usually means you\'ve exceeded your API quota', 'error');
                }
            }
        }

        async function testIngredientLoad() {
            logResult('Testing ingredient database load...', 'info');
            try {
                const response = await fetch('data/ingredients.json');
                const data = await response.json();
                
                if (data.common_ingredients && data.common_ingredients.length > 0) {
                    logResult(`‚úÖ Ingredients loaded: ${data.common_ingredients.length} ingredients`, 'success');
                } else {
                    logResult('‚ùå No ingredients found in database', 'error');
                }
            } catch (error) {
                logResult(`‚ùå Ingredient load error: ${error.message}`, 'error');
            }
        }

        async function quickSearch() {
            const ingredient = document.getElementById('testIngredient').value.trim();
            if (!ingredient) {
                alert('Please enter an ingredient');
                return;
            }

            const resultsDiv = document.getElementById('searchResults');
            resultsDiv.innerHTML = '<p class="loading">Searching...</p>';

            try {
                // Try Spoonacular first
                if (API_CONFIG.SPOONACULAR.API_KEY) {
                    const url = `${API_CONFIG.SPOONACULAR.BASE_URL}${API_CONFIG.SPOONACULAR.ENDPOINTS.FIND_BY_INGREDIENTS}?ingredients=${encodeURIComponent(ingredient)}&number=3&apiKey=${API_CONFIG.SPOONACULAR.API_KEY}`;
                    const response = await fetch(url);
                    
                    if (response.ok) {
                        const recipes = await response.json();
                        displayRecipes(recipes, 'Spoonacular');
                        return;
                    }
                }

                // Fallback to TheMealDB
                const response = await fetch(`${API_CONFIG.THEMEALDB.BASE_URL}${API_CONFIG.THEMEALDB.ENDPOINTS.SEARCH_BY_INGREDIENT}${encodeURIComponent(ingredient)}`);
                const data = await response.json();
                
                if (data.meals) {
                    displayRecipes(data.meals.slice(0, 3), 'TheMealDB');
                } else {
                    resultsDiv.innerHTML = '<p>No recipes found</p>';
                }

            } catch (error) {
                resultsDiv.innerHTML = `<p style="color: red;">Error: ${error.message}</p>`;
            }
        }

        function displayRecipes(recipes, source) {
            const resultsDiv = document.getElementById('searchResults');
            
            if (!recipes || recipes.length === 0) {
                resultsDiv.innerHTML = '<p>No recipes found</p>';
                return;
            }

            let html = `<h3>Found ${recipes.length} recipes from ${source}:</h3><ul>`;
            
            recipes.forEach(recipe => {
                const title = recipe.title || recipe.strMeal || 'Unknown Recipe';
                const image = recipe.image || recipe.strMealThumb || '';
                html += `<li>
                    ${image ? `<img src="${image}" style="width: 50px; height: 50px; object-fit: cover; margin-right: 10px; vertical-align: middle;">` : ''}
                    <strong>${title}</strong>
                </li>`;
            });
            
            html += '</ul>';
            resultsDiv.innerHTML = html;
        }
    </script>
</body>
</html>